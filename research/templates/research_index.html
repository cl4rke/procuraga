{% extends "master.html" %}

{% load staticfiles %}

{% block title %}
	- Market Research Tool
{% endblock %}

{% block statics %}
	<script type="text/javascript" src="{% static "lib/angularjs/angular.min.js" %}"></script>
	<script type="text/javascript" src="{% static "src/js/procuraga.js" %}"></script>
	<script type="text/javascript" src="{% static "src/js/research.js" %}"></script>
{% endblock %}

{% block content %}
	<div ng-controller="ResearchesCtrl as r">
		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
						<h4 class="modal-title" id="myModalLabel"> {[ r.shownItem.item_name ]}</h4>
					</div>
					<div class="modal-body">
						<table class="table table-striped">
							<tr>
								<th> Bidder </th>
								<th> Publish Date </th>
							</tr>
							<tr ng-repeat="bidder in r.shownItem.bidders">
								<td> {[ bidder[0] ]} </td>
								<td> {[ bidder[1].split("T")[0] ]} </td>
							</tr>
						</table>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<div ng-show="r.items.length">
			<form class="form-inline form-group">
				<b> Page Size: </b> <input type="number" class="form-control" ng-model="r.pageSize" min="10">
				<b style="padding-left: 20px"> Page Number: </b>
				<button class="btn btn-info" ng-click="r.currentPage = r.currentPage-1" ng-disabled="r.currentPage == 1">&larr;</button>
				{[ r.currentPage ]} / {[ r.ceil((r.items | filter: r.search).length / r.pageSize) ]}
				<button class="btn btn-info" ng-click="r.currentPage = r.currentPage+1" ng-disabled="r.currentPage == r.ceil((r.items | filter: r.search).length / r.pageSize)">&rarr;</button>
			</form>
			<form class="form-group">
				<input type="search" class="form-control" placeholder="Search" ng-model="r.search">
			</form>
			<div class="table-responsive">
				<table class="table table-bordered" style="background-color: #FFF">
					<thead>
						<tr>
							<th>
								<a href="#" ng-click="r.csort = 'item_name'; r.asc = ! r.asc">
									Item Name
								</a>
								<small> {[ r.csort =='item_name'? (r.asc ? '▲' : '▼') : '' ]} </small>
							</th>
							<th>
								<a href="#" ng-click="r.csort = 'count'; r.asc = ! r.asc">
									Count
								</a>
								<small> {[ r.csort =='count'? (r.asc ? '▲' : '▼') : '' ]} </small>
							</th>
							<th>
								<a href="#" ng-click="r.csort = 'min'; r.asc = ! r.asc">
									Minimum
								</a>
								<small> {[ r.csort =='min'? (r.asc ? '▲' : '▼') : '' ]} </small>
							</th>
							<th>
								<a href="#" ng-click="r.csort = 'max'; r.asc = ! r.asc">
									Maximum
								</a>
								<small> {[ r.csort =='max'? (r.asc ? '▲' : '▼') : '' ]} </small>
							</th>
							<th>
								<a href="#" ng-click="r.csort = 'mean'; r.asc = ! r.asc">
									Mean
								</a>
								<small> {[ r.csort =='mean'? (r.asc ? '▲' : '▼') : '' ]} </small>
							</th>
							<th>
								<a href="#" ng-click="r.csort = 'median'; r.asc = ! r.asc">
									Median
								</a>
								<small> {[ r.csort =='median'? (r.asc ? '▲' : '▼') : '' ]} </small>
							</th>
							<th>
								<a href="#" ng-click="r.csort = 'mode'; r.asc = ! r.asc">
									Mode
								</a>
								<small> {[ r.csort =='mode'? (r.asc ? '▲' : '▼') : '' ]} </small>
							</th>
							<th> Actions </th>
						</tr>
					</thead>
					<tbody ng-repeat="item in r.items | orderBy:r.csort:r.asc | filter: r.search | startFrom: (r.currentPage-1) * r.pageSize | limitTo: r.pageSize">
						<td> {[ item.item_name ]} </td>
						<td> {[ item.count ]} </td>
						<td> {[ item.min | currency:"₱ " ]} </td>
						<td> {[ item.max | currency:"₱ " ]} </td>
						<td> {[ item.mean | currency:"₱ " ]} </td>
						<td> {[ item.median | currency:"₱ " ]} </td>
						<td> {[ item.mode | currency:"₱ " ]} </td>
						<td>
							<!-- Button trigger modal -->
							<center>
								<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" ng-click="r.shownItem=item">
									View Bidders
								</button>
							</center>
						</td>
					</tbody>
				</table>
			</div>
		</div>
		<div ng-hide="r.items.length">
			<h1> Loading... </h1>
		</div>
	</div>
{% endblock %}
